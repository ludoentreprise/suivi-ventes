<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Ventes & URSSAF</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* THÃˆME 3: OLED BLACK */
            --bg-body: #000000;       /* Noir pur */
            --bg-card: #0a0a0a;       /* Gris quasi noir */
            --bg-input: #171717;      /* Gris foncÃ© */
            --text-main: #e5e5e5;     /* Gris clair */
            --text-muted: #737373;    /* Gris moyen */
            --border: #262626;        /* Bordures visibles */
            --primary: #e5e5e5;       /* Blanc pour boutons */
            --primary-hover: #ffffff;
            --success: #22c55e;       /* Vert standard */
            --danger: #ef4444;        /* Rouge */
            --badge-bg: #262626;
            --badge-text: #e5e5e5;
            --radius: 6px;            /* Coins carrÃ©s */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); line-height: 1.5; padding: 2rem 1rem; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* HEADER */
        header { margin-bottom: 2rem; text-align: center; }
        h1 { font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--text-main); }
        .subtitle { color: var(--text-muted); }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: var(--bg-card); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--border); display: flex; flex-direction: column; }
        .stat-label { font-size: 0.875rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--text-main); }
        .stat-value.money { color: var(--success); }
        .stat-subtext { font-size: 0.875rem; color: var(--text-muted); margin-top: auto; padding-top: 0.5rem; }

        /* FORMS & CARDS */
        .card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); padding: 2rem; margin-bottom: 2rem; }
        .card-title { font-size: 1.25rem; font-weight: 700; color: var(--text-main); margin-bottom: 1.5rem; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
        label { font-size: 0.875rem; font-weight: 500; color: var(--text-muted); }
        
        input, select { padding: 0.75rem; background-color: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem; color: var(--text-main); width: 100%; transition: all 0.2s; }
        input:focus, select:focus { outline: none; border-color: var(--text-muted); }
        ::-webkit-calendar-picker-indicator { filter: invert(1); opacity: 0.6; cursor: pointer; }

        .button-group { display: flex; gap: 1rem; }
        button { padding: 0.75rem 1.5rem; border-radius: var(--radius); font-weight: 600; cursor: pointer; border: none; flex: 1; transition: 0.2s; }
        .btn-primary { background-color: var(--primary); color: #000; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        .btn-secondary { background-color: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-secondary:hover { background-color: var(--bg-input); color: var(--text-main); }

        /* TABLE */
        .filter-wrapper { background: var(--bg-input); padding: 1rem; border-radius: var(--radius); margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .monthly-highlight { font-weight: 700; color: var(--success); font-size: 1.1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); }
        .table-responsive { overflow-x: auto; border-radius: var(--radius); border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { padding: 1rem; background-color: #000; font-weight: 600; color: var(--text-muted); text-transform: uppercase; font-size: 0.75rem; }
        td { padding: 1rem; border-top: 1px solid var(--border); color: var(--text-main); font-size: 0.95rem; }
        tr:hover td { background-color: #171717; }
        
        .platform-tag { padding: 0.25rem 0.75rem; border-radius: 99px; font-size: 0.75rem; font-weight: 600; background-color: var(--badge-bg); color: var(--badge-text); border: 1px solid var(--border); }
        .price-tag { font-family: monospace; font-weight: 700; color: var(--success); }
        .btn-delete { background-color: transparent; border: 1px solid var(--border); color: var(--danger); padding: 0.4rem 0.8rem; font-size: 0.8rem; flex: none; width: auto; }
        .btn-delete:hover { background-color: #171717; border-color: var(--danger); }
        .empty-state { padding: 3rem; text-align: center; color: var(--text-muted); }

        @media (max-width: 640px) { h1 { font-size: 1.5rem; } .form-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“ˆ Suivi Ventes & URSSAF</h1>
            <p class="subtitle">ThÃ¨me OLED Black</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Chiffre d'Affaires</div>
                <div class="stat-value money" id="totalRevenue">0.00â‚¬</div>
                <div class="stat-subtext" id="avgPrice">Total global</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ventes</div>
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-subtext" id="monthText">Articles vendus</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Top Plateforme</div>
                <div class="stat-value" id="topPlatform">-</div>
                <div class="stat-subtext" id="topPlatformCount">0 ventes</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">âž• Nouvelle Vente</div>
            <form id="salesForm">
                <div class="form-grid">
                    <div class="form-group"><label>Date</label><input type="date" id="date" required></div>
                    <div class="form-group"><label>Produit</label><input type="text" id="product" placeholder="Ex: Jean Levi's..." required></div>
                    <div class="form-group"><label>Prix (â‚¬)</label><input type="number" id="price" placeholder="0.00" step="0.01" min="0.01" required></div>
                    <div class="form-group">
                        <label>Plateforme</label>
                        <select id="platform" required>
                            <option value="">Choisir...</option>
                            <option value="Vinted">Vinted</option>
                            <option value="LeBonCoin">LeBonCoin</option>
                            <option value="eBay">eBay</option>
                            <option value="Vestiaire Co">Vestiaire Co.</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="button-group">
                    <button type="reset" class="btn-secondary">RÃ©initialiser</button>
                    <button type="submit" class="btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>

        <div class="card">
            <div class="card-title">ðŸ“‹ Historique & DÃ©claration</div>
            <div class="filter-wrapper">
                <div class="form-group">
                    <label>Filtrer par mois (URSSAF)</label>
                    <select id="monthFilter"><option value="">Tout l'historique</option></select>
                </div>
                <div id="monthlyRevenue" class="monthly-highlight">SÃ©lectionnez un mois.</div>
            </div>
            <div class="table-responsive" id="tableContainer">
                <div class="empty-state">Chargement...</div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'SuiviVentesData';

        function loadData() {
            try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; }
        }

        function saveData(sales) {
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(sales)); } catch { alert('Erreur sauvegarde'); }
        }

        document.getElementById('salesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const dateInput = document.getElementById('date').value;
            const productInput = document.getElementById('product').value;
            const price = parseFloat(document.getElementById('price').value);
            const platformInput = document.getElementById('platform').value;

            const sales = loadData();
            sales.push({ id: Date.now(), date: dateInput, product: productInput.trim(), price: price, platform: platformInput });
            saveData(sales);
            
            this.reset();
            document.getElementById('date').valueAsDate = new Date();
            refreshAll();
        });

        function deleteSale(id) {
            if (confirm('Supprimer cette vente ?')) {
                saveData(loadData().filter(s => s.id !== id));
                refreshAll();
            }
        }

        function populateMonthFilter() {
            const sales = loadData();
            const monthSet = new Set(sales.map(s => s.date.substring(0, 7))); // Prend YYYY-MM
            const select = document.getElementById('monthFilter');
            const current = select.value;
            
            select.innerHTML = '<option value="">Tout l\'historique</option>';
            Array.from(monthSet).sort().reverse().forEach(ym => {
                const [y, m] = ym.split('-');
                const name = new Date(y, m - 1).toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
                const opt = document.createElement('option');
                opt.value = ym;
                opt.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                select.appendChild(opt);
            });
            if (current) select.value = current;
        }

        function renderTable() {
            const filter = document.getElementById('monthFilter').value;
            let sales = loadData();
            
            if (filter) sales = sales.filter(s => s.date.startsWith(filter));

            const total = sales.reduce((sum, s) => sum + s.price, 0);
            const disp = document.getElementById('monthlyRevenue');
            
            if (filter) {
                const [y, m] = filter.split('-');
                const name = new Date(y, m - 1).toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
                disp.innerHTML = `CA Ã  dÃ©clarer pour ${name} : <strong>${total.toFixed(2)}â‚¬</strong>`;
            } else {
                disp.innerHTML = `Chiffre d'affaires total : <strong>${total.toFixed(2)}â‚¬</strong>`;
            }

            const container = document.getElementById('tableContainer');
            if (!sales.length) {
                container.innerHTML = `<div class="empty-state">${filter ? 'Rien ce mois-ci.' : 'Aucune vente.'}</div>`;
                return;
            }

            let html = '<table><thead><tr><th>Date</th><th>Produit</th><th>Plateforme</th><th>Prix</th><th></th></tr></thead><tbody>';
            sales.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(s => {
                const d = new Date(s.date).toLocaleDateString('fr-FR', {day:'numeric', month:'short'});
                html += `<tr><td>${d}</td><td>${s.product}</td><td><span class="platform-tag">${s.platform}</span></td><td class="price-tag">${s.price.toFixed(2)}â‚¬</td><td style="text-align:right"><button class="btn-delete" onclick="deleteSale(${s.id})">Ã—</button></td></tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateStats() {
            const sales = loadData();
            if (!sales.length) {
                document.getElementById('totalRevenue').textContent = '0.00â‚¬';
                document.getElementById('totalCount').textContent = '0';
                document.getElementById('topPlatform').textContent = '-';
                return;
            }
            document.getElementById('totalRevenue').textContent = sales.reduce((a,b)=>a+b.price,0).toFixed(2)+'â‚¬';
            document.getElementById('totalCount').textContent = sales.length;
            
            const counts = {};
            sales.forEach(s => counts[s.platform] = (counts[s.platform] || 0) + 1);
            const top = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
            if(top) {
                document.getElementById('topPlatform').textContent = top[0];
                document.getElementById('topPlatformCount').textContent = top[1] + ' vente(s)';
            }
        }

        function refreshAll() { populateMonthFilter(); renderTable(); updateStats(); }
        
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('monthFilter').addEventListener('change', renderTable);
        refreshAll();
    </script>
</body>
</html>
